<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meetings</title>
</head>
<body>
    <a href = "landing.html">Submit a Complaint</a>
    <a href = "register.html">Register</a>
    <a href = "login.html">Login</a>
    <table id = "meetingTable">
        <tr>
            <th>Meeting #</th>
            <th>Location</th>
            <th>Date</th>
            <th>Summary</th>
            <th>Relevant Complaint(s)</th>
        </tr>

    </table>
</body>

<script>
    const meetingTable = document.getElementById("meetingTable");

    async function getMeetings(){
        const httpResponse = await fetch("http://localhost:8080/meetings");
        const meetings = await httpResponse.json();
        return meetings;
    }

    async function getComplaints(){
        const httpResponse = await fetch("http://localhost:8080/complaints");
        const complaints = await httpResponse.json();
        return complaints;
    }

    async function renderMeetingTable(){
        const meetings = await getMeetings();
        const complaints = await getComplaints();

        for (const meeting of meetings){
            if(meeting.meetingId < 0){
                continue;
            }
            const meetingRow = document.createElement("tr");

            const meetingNum = document.createElement("td");
            meetingNum.innerText = meeting.meetingId;

            const meetingLocation = document.createElement("td");
            meetingLocation.innerText = meeting.location;

            const meetingDate = document.createElement("td");
            const convertedDate = new Date(meeting.date *1000);
            meetingDate.innerText = convertedDate.toLocaleString();

            const meetingSummary = document.createElement("td");
            meetingSummary.innerText = meeting.summary;

            const meetingComplaint = document.createElement("td");
            meetingComplaint.innerText = "N/A";
            let resultText = "";
            for (const complaint of complaints){
                if(complaint.meetingId === meeting.meetingId){
                    resultText += '- ' + complaint.compText + '\n';
                }
                
            }
            if(resultText.length > 0){
                meetingComplaint.innerText = resultText;
            }

            meetingRow.appendChild(meetingNum);
            meetingRow.appendChild(meetingLocation);
            meetingRow.appendChild(meetingDate);
            meetingRow.appendChild(meetingSummary);
            meetingRow.appendChild(meetingComplaint);

            meetingTable.appendChild(meetingRow);
        }
    }

    renderMeetingTable();

</script>
</html>